!function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery"],b);else if("undefined"!=typeof exports){var c=require("underscore"),d=require("jquery");module.exports=b(c,d)}else a.Syphon=b(a._,a.jQuery)}(this,function(a,b){var c=function(a){var b={};b.ignoredTypes=["button","submit","reset","fieldset"],b.serialize=function(b,e){var h={},i=f(e),j=c(b,i);return a.each(j,function(a){var b=d(a),c=i.keyExtractors.get(b),e=c(a),f=i.inputReaders.get(b),j=f(a),k=i.keyAssignmentValidators.get(b);if(k(a,e,j)){var l=i.keySplitter(e);h=g(h,l,j)}}),h},b.deserialize=function(b,e,g){var i=f(g),j=c(b,i),k=h(i,e);a.each(j,function(a){var b=d(a),c=i.keyExtractors.get(b),e=c(a),f=i.inputWriters.get(b),g=k[e];f(a,g)})};var c=function(b,c){var f=e(b),g=f.elements;return g=a.filter(g,function(b){var e=d(b),f=c.keyExtractors.get(e),g=f(b);if(""===g)return!1;var h=a.include(c.ignoredTypes,e),i=c.keySplitter(g),j=i.map(function(a,b){return i.slice(0,b+1).reduce(c.keyJoiner)}),k=0!==a.intersection(c.include,j).length,l=0!==a.intersection(c.exclude,j).length;return k?!0:c.include?!1:!(l||h)})},d=function(a){var b,c=a.tagName,d=c;return"input"===c.toLowerCase()&&(b=a.getAttribute("type"),d=b?b:"text"),d.toLowerCase()},e=function(a){var b=a.el||a;return"form"===b.tagName.toLowerCase()||"fieldset"===b.tagName.toLowerCase()?b:b.querySelector("form,fieldset")},f=function(c){var d=a.clone(c)||{};return d.ignoredTypes=a.clone(b.ignoredTypes),d.inputReaders=d.inputReaders||b.InputReaders,d.inputWriters=d.inputWriters||b.InputWriters,d.keyExtractors=d.keyExtractors||b.KeyExtractors,d.keySplitter=d.keySplitter||b.KeySplitter,d.keyJoiner=d.keyJoiner||b.KeyJoiner,d.keyAssignmentValidators=d.keyAssignmentValidators||b.KeyAssignmentValidators,d},g=function(b,c,d){if(!c)return b;var e=c.shift();return b[e]||(b[e]=a.isArray(e)?[]:{}),0===c.length&&(a.isArray(b[e])?b[e].push(d):b[e]=d),c.length>0&&g(b[e],c,d),b},h=function(b,c,d){var e={};return a.each(c,function(c,f){var g={};d&&(f=b.keyJoiner(d,f)),a.isArray(c)?(f+="[]",g[f]=c):a.isObject(c)?g=h(b,c,f):g[f]=c,a.extend(e,g)}),e};return b}(a);c.TypeRegistry=function(){this.registeredTypes={}},a.extend(c.TypeRegistry.prototype,{get:function(a){var b=this.registeredTypes[a];return b||(b=this.registeredTypes["default"]),b},register:function(a,b){this.registeredTypes[a]=b},registerDefault:function(a){this.registeredTypes["default"]=a},unregister:function(a){this.registeredTypes[a]&&delete this.registeredTypes[a]}});var d=function(b,c){var d,e=this;d=b&&a.has(b,"constructor")?b.constructor:function(){return e.apply(this,arguments)},a.extend(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b&&a.extend(d.prototype,b),d.__super__=e.prototype,d};return c.TypeRegistry.extend=d,c.KeyExtractorSet=c.TypeRegistry.extend(),c.KeyExtractors=new c.KeyExtractorSet,c.KeyExtractors.registerDefault(function(a){return a.name}),c.InputReaderSet=c.TypeRegistry.extend(),c.InputReaders=new c.InputReaderSet,c.InputReaders.registerDefault(function(a){return b(a).val()}),c.InputReaders.register("checkbox",function(a){var b=a.checked;return b}),c.InputWriterSet=c.TypeRegistry.extend(),c.InputWriters=new c.InputWriterSet,c.InputWriters.registerDefault(function(a,c){b(a).val(c)}),c.InputWriters.register("checkbox",function(a,b){a.checked=b}),c.InputWriters.register("radio",function(a,c){a.checked=b(a).val()===c.toString()}),c.KeyAssignmentValidatorSet=c.TypeRegistry.extend(),c.KeyAssignmentValidators=new c.KeyAssignmentValidatorSet,c.KeyAssignmentValidators.registerDefault(function(){return!0}),c.KeyAssignmentValidators.register("radio",function(a){return a.checked}),c.KeySplitter=function(a){var b,c=a.match(/[^\[\]]+/g);return a.length>1&&a.indexOf("[]")===a.length-2&&(b=c.pop(),c.push([b])),c||[]},c.KeyJoiner=function(a,b){return a+"["+b+"]"},c});